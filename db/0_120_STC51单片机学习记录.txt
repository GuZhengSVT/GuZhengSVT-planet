<html><head></head><body><h2 id="准备工作"><a href="https://mxts.jiujiuer.xyz/2021/06/17/%E7%89%A9%E7%90%86/%E5%BE%AE%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/STC51%E5%8D%95%E7%89%87%E6%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/#%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C" class="headerlink" title="准备工作"></a>准备工作</h2><h3 id="软件-amp-资料下载"><a href="https://mxts.jiujiuer.xyz/2021/06/17/%E7%89%A9%E7%90%86/%E5%BE%AE%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/STC51%E5%8D%95%E7%89%87%E6%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/#%E8%BD%AF%E4%BB%B6-amp-%E8%B5%84%E6%96%99%E4%B8%8B%E8%BD%BD" class="headerlink" title="软件&amp;资料下载"></a>软件&amp;资料下载</h3><p>实验板到手，第一步当然是下载资料啦。自然要去官网下载：</p><ul><li>stc官网：<a href="http://www.stcmcu.com/">http://www.stcmcu.com</a></li></ul><blockquote><p>顺便，这官网挺瞎眼的（</p></blockquote><p>由于官网过于瞎眼，故将下载链接直接贴出来。</p><ul><li><a href="http://www.stcmcudata.com/STCISP/stc-isp-15xx-v6.88F.zip">STC-ISP软件V6.88F版</a></li></ul><p>这个是烧录用的工具。</p><ul><li><a href="https://www.zdfans.com/html/29618.html">Keil uVision5</a></li></ul><p>直接放上下载站的链接。直链在此：<a href="http://zd1.wzhszm.com/KeiluVision_29618.zip?md5=NGfNpsLPv_KDgWk_1TCe3A&amp;expires=1624016762">点击下载</a>（不一定稳定）。下载站上有注册教程。</p><ul><li><a href="https://www.stcmcudata.com/datasheet/stc/STC-AD-PDF/STC89C51RC-RD.pdf">STC89C51RC用户手册</a></li></ul><h3 id="大致流程"><a href="https://mxts.jiujiuer.xyz/2021/06/17/%E7%89%A9%E7%90%86/%E5%BE%AE%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/STC51%E5%8D%95%E7%89%87%E6%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/#%E5%A4%A7%E8%87%B4%E6%B5%81%E7%A8%8B" class="headerlink" title="大致流程"></a>大致流程</h3><p>初步练习后，大致梳理如下。</p><ul><li><p><strong>构思&amp;设计电路</strong>。没啥好说的，咱也不会，就……边做边查呗（</p></li><li><p><strong>写好程序</strong>。个人习惯vim/vs code，比较方便。只要引入头文件 reg52.h ，后续开发照着C语言通常的流程即可。</p></li><li><p><strong>编译程序</strong>。使用上文提供的 Keil 编译程序，生成.hex文件（其实我挺好奇能不能用gcc……虽然估计不行）。这个.hex文件（看后缀，即十六进制文件）就是目标程序了。</p></li><li><p><strong>烧录程序</strong>。使用上面提到的 STC-ISP 工具进行烧录即可。烧录操作后面写，可先参考<a href="https://blog.csdn.net/zhouyingge1104/article/details/88085350?depth_1-utm_source=distribute.pc_relevant.none-task-blog-OPENSEARCH-1&amp;utm_source=distribute.pc_relevant.none-task-blog-OPENSEARCH-1">这篇文章</a>。</p></li></ul><p>好了，到这里就是测试程序了（回想起被wer支配的恐惧）。</p><h3 id="FAQ（Frequently-asked-questions）"><a href="https://mxts.jiujiuer.xyz/2021/06/17/%E7%89%A9%E7%90%86/%E5%BE%AE%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/STC51%E5%8D%95%E7%89%87%E6%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/#FAQ%EF%BC%88Frequently-asked-questions%EF%BC%89" class="headerlink" title="FAQ（Frequently asked questions）"></a>FAQ（Frequently asked questions）</h3><blockquote><p>Q：打开Keil新建工程，找不到stc51单片机怎么办？<br/>A：<a href="https://blog.csdn.net/zhuoqingjoking97298/article/details/105517884">看这儿</a>。用stc-isp导入一下数据库到keil安装目录就好了。  </p></blockquote><blockquote><p>Q:Keil要激活才能用？<br/>A:别担心，网上激活教程一大把。<a href="https://blog.csdn.net/qq_36306781/article/details/80555704">看这儿</a>。文章里提到的注册机，已经包含在了我提供的Keil安装包里，下好之后照着文章操作就好。</p></blockquote><blockquote><p>Q:烧录程序失败？<br/>A:stc51通病（貌似）。烧录按钮点了之后断一下开发板的电，然后重新上电即可。</p></blockquote><blockquote><p>开发板到了。所以储物间又上了一本资料。还挺全的，初期入门用吧。</p></blockquote><h2 id="第一课：LED闪烁"><a href="https://mxts.jiujiuer.xyz/2021/06/17/%E7%89%A9%E7%90%86/%E5%BE%AE%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/STC51%E5%8D%95%E7%89%87%E6%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/#%E7%AC%AC%E4%B8%80%E8%AF%BE%EF%BC%9ALED%E9%97%AA%E7%83%81" class="headerlink" title="第一课：LED闪烁"></a>第一课：LED闪烁</h2><p>代码其实很简单。MCU的编程方式和传统C语言程序相比挺怪的。代码如下：</p><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/></pre></td><td class="code"><pre><span class="line">/*Example-1_switch-led*/</span><br/><span class="line"></span><br/><span class="line">#include &#34;reg52.h&#34;</span><br/><span class="line"></span><br/><span class="line">typedef unsigned int u16;</span><br/><span class="line">sbit LED=P2^0;   </span><br/><span class="line">sbit LED_1=P2^1;</span><br/><span class="line"></span><br/><span class="line">void delay(u16 i)</span><br/><span class="line">{</span><br/><span class="line"> while(i--);</span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line">void main()</span><br/><span class="line">{</span><br/><span class="line"> LED_1=0; </span><br/><span class="line"></span><br/><span class="line"> while(1)</span><br/><span class="line"> {</span><br/><span class="line">  LED=0;</span><br/><span class="line">  delay(50000);</span><br/><span class="line">  LED=1;</span><br/><span class="line">  delay(50000);</span><br/><span class="line"> }</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure><p>写完之后，keil编译生成.hex文件，丢到stc-isp里一下载，完事儿。目测成功。不过这里面还有一点坑：</p><ul><li>编译之后，如果没有生成.hex文件，那多半是没设置output生成.hex文件，照着底下几张图设置一下就能解决了。</li></ul><p>点击下图这个魔术棒标志。</p><p><img src="https://exp-picture.cdn.bcebos.com/fab31cb375d7997be1ae39ecf9dade49600fd9f2.jpg?x-bce-process=image/resize,m_lfit,w_500,limit_1/quality,q_80"/></p><p>如下图，勾选Create hex file即可。</p><p><img src="https://exp-picture.cdn.bcebos.com/a31e1214c27bd282fdd342f23cb1eef97ebd36f3.jpg?x-bce-process=image/resize,m_lfit,w_500,limit_1/quality,q_80"/></p><p>然后编译。输出的信息里有下图这样的creating hex file from XXX就说明应该没啥问题。</p><p><img src="https://exp-picture.cdn.bcebos.com/7c84d1672b5fd54688cc5ba07fd0b503c9d224f3.jpg?x-bce-process=image/resize,m_lfit,w_500,limit_1/quality,q_80"/></p><h3 id="概览"><a href="https://mxts.jiujiuer.xyz/2021/06/17/%E7%89%A9%E7%90%86/%E5%BE%AE%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/STC51%E5%8D%95%E7%89%87%E6%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/#%E6%A6%82%E8%A7%88" class="headerlink" title="概览"></a>概览</h3><p>回头看看这个程序。它和传统C语言程序的区别主要是这几点：</p><ul><li>多了个头文件reg51.h/reg52.h。这个头文件对于单片机编译很重要</li><li>使用循环来达到延时的目的。上面的程序就使用了while循环来延时</li><li>通过设置sbit类型变量的值为1/0实现对应引脚高低电平的转换</li></ul><p>其他的，基本和常规C语言没什么区别。所以，后面主要学习的，应该就是引脚的相关内容了。</p><h2 id="第二课：用ESP8266实现通信"><a href="https://mxts.jiujiuer.xyz/2021/06/17/%E7%89%A9%E7%90%86/%E5%BE%AE%E7%94%B5%E5%AD%90%E6%8A%80%E6%9C%AF/STC51%E5%8D%95%E7%89%87%E6%9C%BA%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/#%E7%AC%AC%E4%BA%8C%E8%AF%BE%EF%BC%9A%E7%94%A8ESP8266%E5%AE%9E%E7%8E%B0%E9%80%9A%E4%BF%A1" class="headerlink" title="第二课：用ESP8266实现通信"></a>第二课：用ESP8266实现通信</h2><p><em>《关于我报名比赛后才开始学MCU编程这件事》</em></p><p>ESP8266因为便宜和足够强大，所以在物联网上有着很广泛的应用。它的使用也比较简单，指令较少。</p><figure class="highlight c"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/><span class="line">39</span><br/><span class="line">40</span><br/><span class="line">41</span><br/><span class="line">42</span><br/><span class="line">43</span><br/><span class="line">44</span><br/><span class="line">45</span><br/><span class="line">46</span><br/><span class="line">47</span><br/><span class="line">48</span><br/><span class="line">49</span><br/><span class="line">50</span><br/><span class="line">51</span><br/><span class="line">52</span><br/><span class="line">53</span><br/><span class="line">54</span><br/><span class="line">55</span><br/><span class="line">56</span><br/><span class="line">57</span><br/><span class="line">58</span><br/><span class="line">59</span><br/><span class="line">60</span><br/><span class="line">61</span><br/><span class="line">62</span><br/><span class="line">63</span><br/><span class="line">64</span><br/><span class="line">65</span><br/><span class="line">66</span><br/><span class="line">67</span><br/><span class="line">68</span><br/><span class="line">69</span><br/><span class="line">70</span><br/><span class="line">71</span><br/><span class="line">72</span><br/><span class="line">73</span><br/><span class="line">74</span><br/><span class="line">75</span><br/><span class="line">76</span><br/><span class="line">77</span><br/><span class="line">78</span><br/><span class="line">79</span><br/><span class="line">80</span><br/><span class="line">81</span><br/><span class="line">82</span><br/><span class="line">83</span><br/><span class="line">84</span><br/><span class="line">85</span><br/><span class="line">86</span><br/><span class="line">87</span><br/><span class="line">88</span><br/><span class="line">89</span><br/><span class="line">90</span><br/><span class="line">91</span><br/><span class="line">92</span><br/><span class="line">93</span><br/><span class="line">94</span><br/><span class="line">95</span><br/><span class="line">96</span><br/><span class="line">97</span><br/><span class="line">98</span><br/><span class="line">99</span><br/><span class="line">100</span><br/><span class="line">101</span><br/><span class="line">102</span><br/><span class="line">103</span><br/><span class="line">104</span><br/><span class="line">105</span><br/><span class="line">106</span><br/><span class="line">107</span><br/><span class="line">108</span><br/><span class="line">109</span><br/><span class="line">110</span><br/><span class="line">111</span><br/><span class="line">112</span><br/><span class="line">113</span><br/><span class="line">114</span><br/><span class="line">115</span><br/><span class="line">116</span><br/><span class="line">117</span><br/><span class="line">118</span><br/><span class="line">119</span><br/><span class="line">120</span><br/><span class="line">121</span><br/><span class="line">122</span><br/><span class="line">123</span><br/><span class="line">124</span><br/><span class="line">125</span><br/><span class="line">126</span><br/><span class="line">127</span><br/><span class="line">128</span><br/><span class="line">129</span><br/><span class="line">130</span><br/><span class="line">131</span><br/><span class="line">132</span><br/><span class="line">133</span><br/><span class="line">134</span><br/><span class="line">135</span><br/><span class="line">136</span><br/><span class="line">137</span><br/><span class="line">138</span><br/><span class="line">139</span><br/><span class="line">140</span><br/><span class="line">141</span><br/><span class="line">142</span><br/><span class="line">143</span><br/><span class="line">144</span><br/><span class="line">145</span><br/><span class="line">146</span><br/><span class="line">147</span><br/><span class="line">148</span><br/><span class="line">149</span><br/><span class="line">150</span><br/><span class="line">151</span><br/><span class="line">152</span><br/><span class="line">153</span><br/><span class="line">154</span><br/><span class="line">155</span><br/><span class="line">156</span><br/><span class="line">157</span><br/><span class="line">158</span><br/><span class="line">159</span><br/></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&#34;reg52.h&#34;</span></span></span><br/><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br/><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br/><span class="line"></span><br/><span class="line"><span class="meta">#<span class="keyword">define</span> uchar unsigned char</span></span><br/><span class="line"><span class="meta">#<span class="keyword">define</span> uint unsigned int</span></span><br/><span class="line"></span><br/><span class="line">uchar ReceiveData[<span class="number">5</span>]; <span class="comment">//回传的数组</span></span><br/><span class="line">uchar countnumber;</span><br/><span class="line"></span><br/><span class="line"><span class="type">void</span> <span class="title function_">uart_init</span><span class="params">()</span> <span class="comment">//串口的初始化</span></span><br/><span class="line">{</span><br/><span class="line">    <span class="comment">//9600bps@11.0592MHz</span></span><br/><span class="line">    PCON &amp;= <span class="number">0x7F</span>; <span class="comment">//波特率不倍速</span></span><br/><span class="line">    SCON = <span class="number">0x50</span>;  <span class="comment">//8位数据,可变波特率</span></span><br/><span class="line">    AUXR |= <span class="number">0x40</span>; <span class="comment">//定时器1时钟为Fosc,即1T</span></span><br/><span class="line">    AUXR &amp;= <span class="number">0xFE</span>; <span class="comment">//串口1选择定时器1为波特率发生器</span></span><br/><span class="line">    TMOD &amp;= <span class="number">0x0F</span>; <span class="comment">//清除定时器1模式位</span></span><br/><span class="line">    TMOD |= <span class="number">0x20</span>; <span class="comment">//设定定时器1为8位自动重装方式</span></span><br/><span class="line">    TL1 = <span class="number">0xDC</span>;   <span class="comment">//设定定时初值</span></span><br/><span class="line">    TH1 = <span class="number">0xDC</span>;   <span class="comment">//设定定时器重装值</span></span><br/><span class="line">    ET1 = <span class="number">0</span>;      <span class="comment">//禁止定时器1中断</span></span><br/><span class="line">    TR1 = <span class="number">1</span>;      <span class="comment">//启动定时器1</span></span><br/><span class="line">    EA = <span class="number">1</span>;</span><br/><span class="line">    ES = <span class="number">1</span>;</span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line"><span class="type">void</span> <span class="title function_">delayms</span><span class="params">(uint xms)</span> <span class="comment">//延时</span></span><br/><span class="line">{</span><br/><span class="line">    uint i, j;</span><br/><span class="line">    <span class="keyword">for</span> (i = xms; i &gt; <span class="number">0</span>; i--)</span><br/><span class="line">        <span class="keyword">for</span> (j = <span class="number">110</span>; j &gt; <span class="number">0</span>; j--)</span><br/><span class="line">            ;</span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line"><span class="type">void</span> <span class="title function_">Sent_ZF</span><span class="params">(uchar dat)</span> <span class="comment">//发送一个字节</span></span><br/><span class="line">{</span><br/><span class="line">    ES = <span class="number">0</span>;</span><br/><span class="line">    TI = <span class="number">0</span>;</span><br/><span class="line">    SBUF = dat;</span><br/><span class="line">    <span class="keyword">while</span> (!TI)</span><br/><span class="line">        ;</span><br/><span class="line">    TI = <span class="number">0</span>;</span><br/><span class="line">    ES = <span class="number">1</span>;</span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line"><span class="type">void</span> <span class="title function_">send</span><span class="params">(uchar *<span class="built_in">string</span>)</span> <span class="comment">//发送字符串</span></span><br/><span class="line">{</span><br/><span class="line">    <span class="keyword">while</span> (*<span class="built_in">string</span>)</span><br/><span class="line">    {</span><br/><span class="line">        Sent_ZF(*<span class="built_in">string</span>++);</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line"><span class="type">void</span> <span class="title function_">Uart1</span><span class="params">()</span> interrupt 4 <span class="comment">//串口1 接收数据4wei（收到8266回传的OK，其实是\r\nOK）</span></span><br/><span class="line">{                        <span class="comment">//当然是因为目前8266里面刷的AT固件是出厂默认固件</span></span><br/><span class="line">    uchar a;</span><br/><span class="line">    <span class="keyword">if</span> (RI == <span class="number">1</span>)</span><br/><span class="line">    {</span><br/><span class="line"></span><br/><span class="line">        <span class="comment">//RI=0;       //复位中断请求标志,接收数据后置1</span></span><br/><span class="line">        a = SBUF; <span class="comment">//接收数据</span></span><br/><span class="line">        RI = <span class="number">0</span>;   <span class="comment">//复位中断请求标志,接收数据后置1</span></span><br/><span class="line"></span><br/><span class="line">        *(ReceiveData + countnumber) = a;</span><br/><span class="line">        countnumber++;</span><br/><span class="line"></span><br/><span class="line">        <span class="keyword">if</span> (countnumber &gt; <span class="number">4</span>)</span><br/><span class="line">        {</span><br/><span class="line">            countnumber = <span class="number">0</span>;</span><br/><span class="line">        }</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line">uchar <span class="title function_">data_compare</span><span class="params">(uchar *p)</span> <span class="comment">//比较字符串</span></span><br/><span class="line">{</span><br/><span class="line">    <span class="keyword">if</span> (<span class="built_in">strstr</span>(ReceiveData, p) != <span class="literal">NULL</span>)</span><br/><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br/><span class="line">    <span class="keyword">else</span></span><br/><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line"><span class="type">void</span> <span class="title function_">wifi_init</span><span class="params">()</span> <span class="comment">//初始化wifi模块</span></span><br/><span class="line">{</span><br/><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br/><span class="line">    {</span><br/><span class="line">        send(<span class="string">&#34;AT+RST\r\n&#34;</span>); <span class="comment">//往串口发重启指令</span></span><br/><span class="line">        <span class="keyword">if</span> (data_compare(<span class="string">&#34;OK&#34;</span>))</span><br/><span class="line">            <span class="keyword">break</span>;</span><br/><span class="line"></span><br/><span class="line">        delayms(<span class="number">600</span>); <span class="comment">//适当延时，给wifi模块一点反应时间</span></span><br/><span class="line">    }</span><br/><span class="line">    <span class="built_in">memset</span>(ReceiveData, <span class="number">0</span>, <span class="number">5</span>);</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br/><span class="line">    {</span><br/><span class="line">        send(<span class="string">&#34;AT+CWMODE=1\r\n&#34;</span>); <span class="comment">//选择STA模式</span></span><br/><span class="line">        <span class="keyword">if</span> (data_compare(<span class="string">&#34;OK&#34;</span>))</span><br/><span class="line">            <span class="keyword">break</span>;</span><br/><span class="line"></span><br/><span class="line">        delayms(<span class="number">600</span>); <span class="comment">//适当延时，给wifi模块一点反应时间</span></span><br/><span class="line">    }</span><br/><span class="line">    <span class="built_in">memset</span>(ReceiveData, <span class="number">0</span>, <span class="number">5</span>);</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br/><span class="line">    {</span><br/><span class="line">        send(<span class="string">&#34;AT+CIPMUX=0\r\n&#34;</span>); <span class="comment">//单通道模式</span></span><br/><span class="line">        <span class="keyword">if</span> (data_compare(<span class="string">&#34;OK&#34;</span>))</span><br/><span class="line">            <span class="keyword">break</span>;</span><br/><span class="line"></span><br/><span class="line">        delayms(<span class="number">600</span>); <span class="comment">//适当延时，给wifi模块一点反应时间</span></span><br/><span class="line">    }</span><br/><span class="line">    <span class="built_in">memset</span>(ReceiveData, <span class="number">0</span>, <span class="number">5</span>);</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br/><span class="line">    {</span><br/><span class="line">        send(<span class="string">&#34;AT+CIPSTART=\&#34;TCP\&#34;,\&#34;192.168.1.100\&#34;,8080\r\n&#34;</span>); <span class="comment">//往串口发重启指令</span></span><br/><span class="line">        <span class="keyword">if</span> (data_compare(<span class="string">&#34;OK&#34;</span>))</span><br/><span class="line">            <span class="keyword">break</span>;</span><br/><span class="line"></span><br/><span class="line">        delayms(<span class="number">600</span>); <span class="comment">//适当延时，给wifi模块一点反应时间</span></span><br/><span class="line">    }</span><br/><span class="line">    <span class="built_in">memset</span>(ReceiveData, <span class="number">0</span>, <span class="number">5</span>);</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br/><span class="line">    {</span><br/><span class="line">        send(<span class="string">&#34;AT+CIPMODE=1\r\n&#34;</span>); <span class="comment">//选择透传</span></span><br/><span class="line">        <span class="keyword">if</span> (data_compare(<span class="string">&#34;OK&#34;</span>))</span><br/><span class="line">            <span class="keyword">break</span>;</span><br/><span class="line"></span><br/><span class="line">        delayms(<span class="number">600</span>); <span class="comment">//适当延时，给wifi模块一点反应时间</span></span><br/><span class="line">    }</span><br/><span class="line">    <span class="built_in">memset</span>(ReceiveData, <span class="number">0</span>, <span class="number">5</span>);</span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br/><span class="line">    {</span><br/><span class="line">        send(<span class="string">&#34;AT+CIPSEND\r\n&#34;</span>); <span class="comment">//发送数据命令</span></span><br/><span class="line">        <span class="keyword">if</span> (data_compare(<span class="string">&#34;OK&#34;</span>))</span><br/><span class="line">            <span class="keyword">break</span>;</span><br/><span class="line"></span><br/><span class="line">        delayms(<span class="number">600</span>); <span class="comment">//适当延时，给wifi模块一点反应时间</span></span><br/><span class="line">    }</span><br/><span class="line">    <span class="built_in">memset</span>(ReceiveData, <span class="number">0</span>, <span class="number">5</span>);</span><br/><span class="line">}</span><br/><span class="line"></span><br/><span class="line"><span class="type">void</span> <span class="title function_">main</span><span class="params">()</span></span><br/><span class="line">{</span><br/><span class="line"></span><br/><span class="line">    P27 = <span class="number">0</span>; <span class="comment">//蜂鸣器</span></span><br/><span class="line">    uart_init();</span><br/><span class="line">    delayms(<span class="number">2000</span>);</span><br/><span class="line">    wifi_init(); <span class="comment">//就可连上服务端了</span></span><br/><span class="line"></span><br/><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br/><span class="line">    {</span><br/><span class="line">        <span class="comment">//do something</span></span><br/><span class="line">        ;</span><br/><span class="line">    }</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure></body></html>