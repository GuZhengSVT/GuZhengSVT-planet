<html><head></head><body><p>改公式渲染太痛苦了，可以先看我先前做的PPT: [Heitz14]Microfacet Models（密码：1234）。<br/>这个笔记原本是对浅墨PBR白皮书、闫老师GAMES202、Heitz14年的文章的总结，这里推荐一下我当时参考的内容：<br/>PBR-White-Paper<br/>[Hetiz14]Understanding the Masking-Shadowing Function in Microfacet-Based BRDF<br/>理解微表面BRDF中的遮挡阴影函数<br/>Heitz14的understanding paper是很好的总结，写的也很浅显易懂，推荐必读。<br/>microfacet模型只是physically based BRDF中的一种，但它也同时是很多后续模型的基础。经过这段时间的学习，我感觉如果要对microfacet模型有了解，那至少需要知道：<br/>几种常见法线分布及其特性 用于解决shadowing-masking问题的V-cavity或Smith模型 基本的形式和推导 各自的优点和不足 对能量守恒问题的解决 值得注意的是，作为一个physically based BRDF，互易性和能量守恒是很重要的两点，也是贯穿之后很多模型的评价基准。<br/>Microfacet 微表面模型（Microfacet Material）是更接近于物理的材质描述，相比于Lambertian模型、Phong模型，它可以用来描述更复杂的场景。<br/>我们认为广表面（Macrosurface） 是平坦且粗糙的，但是微表面（Microsurface）是凹凸不平但是光滑的（每一个小的面都是光滑平坦的）。粗糙的广表面是由一个个微表面组成，微表面是完美的平面，其朝向不同。<br/>对于微表面模型，整体的光线反射情况应当是所有微表面反射情况的总和。从近处看是几何，从远处看就是一种材质。<br/>广表面的粗糙程度取决于微表面的法线的方差，微表面法线方差越大，广表面越粗糙，表面取向与整个宏观表面取向的偏离更强，反射越模糊，整体越呈现为diffuse的效果。<br/>对于微表面的不同材质，可以考虑通过微表面法线分布进行表示：(Microfacet Cook-Torrance BRDF) $$ f(i,o)=\frac{F(i,h)G(i,o,h)D(h)}{4(n,i)(n,o)} $$ 其中$$F(i,h)$$即菲涅尔项Fresnel Term，$$G(i,o,h)$$是几何项 Shadowing-masking term，，$$D(h)$$是沿着半程向量的法线分布。<br/>Fresnel Term: F 菲涅尔项告诉了我们不同入射角度的情况下反射的光线的强度，主要表现在grazing angle时光的反射率会增加。<br/>宏观菲涅尔现象的可以理解为微观微平面菲涅尔效应的平均值，这也为Microfacet模型可以呈现出菲涅尔现象提供了理论基础。它也阐释了对于不同材质的微表面模型，菲涅尔现象的强弱也是不一样的，这主要取决于法线分布。<br/>麦克斯韦方程组描述的是折射率变化时光的行为，菲涅尔方程实际上是麦克斯韦方程组的特解。对于不同的材质参数，有不同的反射率：<br/>近似估计<br/>由$F(\omega_o)$ 菲涅尔项进行描述。给定入射光线角度和材质信息，求反射的比例（水面垂直的看通透，斜看如镜子）<br/>我们称入射角为0°时的菲涅尔反射率为$F_0$，按Schlick对F的近似估计： $$ F_0=(\frac{\eta_\lambda-1}{\eta_\lambda+1})^2\ F_{Schlick}=F_0+(1-F_0)(1-cos\theta_d)^5 $$<br/>Normal Distribution Function: D 对于微表面模型，最重要的实际是微表面自身的法线分布NDF（Normal Distribution Function, [1/steradians]）。它在统计上是微观几何表面区域上的微平面表面法线的统计分布；在空间上是法线的密度函数，在微平面法线更可能指向的方向上具有更高的值。<br/>NDF在球面的积分是微平面的面积，其对于某特定视图方向上的投影满足归一化。<br/>对于任何一种材质，我们使用法线分布来描述其材质。如果是光滑glossy的表面，那么法线分布比较集中；否则，法线会分布在四处，呈现出类似diffuse的效果。<br/>在图像上，NDF基本都是$D(m)$以中心为峰值，随着$|\theta_m|$的增大，向外不断衰减。NDF本身是定义在半球面上的，我们希望将它显示在圆上，则按projected solid angle，自上向下俯视观察。<br/>数值约束<br/>在数值上，我们通常将NDF投影到宏观表平面macrosurface上进行讨论，即讨论$D(m)( n\cdot m)$，我们可以注意到一个基于物理的NDF需要满足这些约束：（$\Theta$通常表示球体，$\Omega$表示半球，模型通常在高度场heightfields中考虑）</p></body></html>