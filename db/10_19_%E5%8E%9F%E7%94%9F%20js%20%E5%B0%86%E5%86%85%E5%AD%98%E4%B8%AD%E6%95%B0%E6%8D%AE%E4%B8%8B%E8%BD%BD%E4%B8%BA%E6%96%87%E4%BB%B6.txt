<html><head></head><body><h1 id="原生-js-将内存中数据下载为文件">原生 js 将内存中数据下载为文件<a class="headerlink" href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#%E5%8E%9F%E7%94%9F-js-%E5%B0%86%E5%86%85%E5%AD%98%E4%B8%AD%E6%95%B0%E6%8D%AE%E4%B8%8B%E8%BD%BD%E4%B8%BA%E6%96%87%E4%BB%B6" title="Permanent link">¶</a></h1><!-- more --><h2 id="实现">实现<a class="headerlink" href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#%E5%AE%9E%E7%8E%B0" title="Permanent link">¶</a></h2><p>借助 <code>HTMLAnchorElement</code> 实现。</p><div class="highlight"><pre><span></span><code><span class="kd">function</span><span class="w"> </span><span class="nx">downloadAsFile</span><span class="p">(</span><span class="nx">fileName</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileName</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">;</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span><span class="p">}</span></code></pre></div><h2 id="例子">例子<a class="headerlink" href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#%E4%BE%8B%E5%AD%90" title="Permanent link">¶</a></h2><p>例如，要将 <code>data</code> 保存为 json 文件。可以创建一个 <code>Blob</code> 再调用上面的函数实现。</p><div class="highlight"><pre><span></span><code><span class="kd">const</span><span class="w"> </span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">)],</span><span class="w"> </span><span class="p">{</span><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&#34;application/json&#34;</span><span class="p">,</span><span class="p">});</span><span class="c1">// 上面指定了 blob 的 MIME type 是 json，所以文件扩展名可以不写</span><span class="nx">downloadAsFile</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">blob</span><span class="p">);</span></code></pre></div></body></html>