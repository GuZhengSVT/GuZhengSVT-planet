<html><head></head><body><h2 id="其一"><a href="https://mxts.jiujiuer.xyz/2021/07/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/PHP/PHP%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81/#%E5%85%B6%E4%B8%80" class="headerlink" title="其一"></a>其一</h2><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/><span class="line">15</span><br/><span class="line">16</span><br/><span class="line">17</span><br/><span class="line">18</span><br/><span class="line">19</span><br/><span class="line">20</span><br/><span class="line">21</span><br/><span class="line">22</span><br/><span class="line">23</span><br/><span class="line">24</span><br/><span class="line">25</span><br/><span class="line">26</span><br/><span class="line">27</span><br/><span class="line">28</span><br/><span class="line">29</span><br/><span class="line">30</span><br/><span class="line">31</span><br/><span class="line">32</span><br/><span class="line">33</span><br/><span class="line">34</span><br/><span class="line">35</span><br/><span class="line">36</span><br/><span class="line">37</span><br/><span class="line">38</span><br/></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br/><span class="line"> </span><br/><span class="line">$filename = $_GET[&#39;filename&#39;];</span><br/><span class="line"> </span><br/><span class="line">// 修改这一行设置你的文件下载目录</span><br/><span class="line">$download_path = &#34;ficheros/&#34;;</span><br/><span class="line"> </span><br/><span class="line">// 不能下载上一层目录的文件</span><br/><span class="line">if(eregi(&#34;\.\.&#34;, $filename)) die(&#34;抱歉，你不能下载该文件！&#34;);</span><br/><span class="line">$file = str_replace(&#34;..&#34;, &#34;&#34;, $filename);</span><br/><span class="line"> </span><br/><span class="line">// 包含 .ht 的文件不能下载</span><br/><span class="line">if(eregi(&#34;\.ht.+&#34;, $filename)) die(&#34;抱歉，你不能下载该文件！&#34;);</span><br/><span class="line"> </span><br/><span class="line">// 创建文件下载路径</span><br/><span class="line">$file = &#34;$download_path$file&#34;;</span><br/><span class="line"> </span><br/><span class="line">// 判断文件是否存在</span><br/><span class="line">if(!file_exists($file)) die(&#34;抱歉，文件不存在！&#34;);</span><br/><span class="line"> </span><br/><span class="line">//  文件类型，作为头部发送给浏览器</span><br/><span class="line">$type = filetype($file);</span><br/><span class="line"> </span><br/><span class="line">// 获取时间和日期</span><br/><span class="line">$today = date(&#34;F j, Y, g:i a&#34;);</span><br/><span class="line">$time = time();</span><br/><span class="line"> </span><br/><span class="line">// 发送文件头部</span><br/><span class="line">header(&#34;Content-type: $type&#34;);</span><br/><span class="line">header(&#34;Content-Disposition: attachment;filename=$filename&#34;);</span><br/><span class="line">header(&#34;Content-Transfer-Encoding: binary&#34;);</span><br/><span class="line">header(&#39;Pragma: no-cache&#39;);</span><br/><span class="line">header(&#39;Expires: 0&#39;);</span><br/><span class="line">// 发送文件内容</span><br/><span class="line">set_time_limit(0);</span><br/><span class="line">readfile($file);</span><br/><span class="line"> </span><br/><span class="line">?&gt;</span><br/></pre></td></tr></tbody></table></figure><h2 id="其二"><a href="https://mxts.jiujiuer.xyz/2021/07/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/PHP/PHP%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81/#%E5%85%B6%E4%BA%8C" class="headerlink" title="其二"></a>其二</h2><ul><li>其实这算html常规方式（</li></ul><figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line">&lt;button&gt;</span><br/><span class="line">    &lt;a href = &#34;http://localhost/down.zip&#34;&gt;</span><br/><span class="line">    下载文件</span><br/><span class="line">&lt;/button&gt;</span><br/></pre></td></tr></tbody></table></figure><h2 id="其三"><a href="https://mxts.jiujiuer.xyz/2021/07/18/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%A7%91%E5%AD%A6/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/PHP/PHP%E6%96%87%E4%BB%B6%E4%B8%8B%E8%BD%BD%E4%BB%A3%E7%A0%81/#%E5%85%B6%E4%B8%89" class="headerlink" title="其三"></a>其三</h2><p>传递参数：</p><figure class="highlight html"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span>&gt;</span></span><br/><span class="line">    <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span> = <span class="string">&#34;http://localhost?f=&#39;down&#39;&#34;</span>&gt;</span></span><br/><span class="line">    下载文件</span><br/><span class="line"><span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br/></pre></td></tr></tbody></table></figure><p>查找文件并挑战到下载链接：</p><figure class="highlight php"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br/><span class="line">2</span><br/><span class="line">3</span><br/><span class="line">4</span><br/><span class="line">5</span><br/><span class="line">6</span><br/><span class="line">7</span><br/><span class="line">8</span><br/><span class="line">9</span><br/><span class="line">10</span><br/><span class="line">11</span><br/><span class="line">12</span><br/><span class="line">13</span><br/><span class="line">14</span><br/></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br/><span class="line"></span><br/><span class="line"><span class="variable">$down</span> = <span class="variable">$_GET</span>[<span class="string">&#39;f&#39;</span>];   <span class="comment">//获取文件参数</span></span><br/><span class="line"><span class="variable">$filename</span> = <span class="variable">$down</span>.<span class="string">&#39;.zip&#39;</span>; <span class="comment">//获取文件名称</span></span><br/><span class="line"><span class="variable">$dir</span> =<span class="string">&#34;down/&#34;</span>;  <span class="comment">//相对于网站根目录的下载目录路径</span></span><br/><span class="line"><span class="variable">$down_host</span> = <span class="variable">$_SERVER</span>[<span class="string">&#39;HTTP_HOST&#39;</span>].<span class="string">&#39;/&#39;</span>; <span class="comment">//当前域名</span></span><br/><span class="line"></span><br/><span class="line"></span><br/><span class="line"><span class="comment">//判断如果文件存在,则跳转到下载路径</span></span><br/><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="keyword">__DIR__</span>.<span class="string">&#39;/&#39;</span>.<span class="variable">$dir</span>.<span class="variable">$filename</span>)){</span><br/><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#39;location:http://&#39;</span>.<span class="variable">$down_host</span>.<span class="variable">$dir</span>.<span class="variable">$filename</span>);</span><br/><span class="line">}<span class="keyword">else</span>{</span><br/><span class="line">    <span class="title function_ invoke__">header</span>(<span class="string">&#39;HTTP/1.1 404 Not Found&#39;</span>);</span><br/><span class="line">}</span><br/></pre></td></tr></tbody></table></figure></body></html>