<html><head></head><body><h2 id="序言"><a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/#%E5%BA%8F%E8%A8%80" class="headerlink" title="序言"></a>序言</h2><p>之前，我发过一篇详细注释过的ECL脚本。当时是在做绀珠传的符卡魔改来着……不过已经咕了太久了。这次，我打算从头开始，详细记录一下魔改的相关知识。</p><h2 id="关于魔改"><a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/#%E5%85%B3%E4%BA%8E%E9%AD%94%E6%94%B9" class="headerlink" title="关于魔改"></a>关于魔改</h2><p>魔改（modification），也就是mod，指的就是通过技术手段对程序进行修改，从而达到一些目的（比如东方正作STG的魔改，一般都是为了整活XD）。对[[東方Project：同人界永远的奇迹|东方]]的魔改，一般就是玩法拓展，贴图更换，弹幕创新之类的。</p><h2 id="能改什么"><a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/#%E8%83%BD%E6%94%B9%E4%BB%80%E4%B9%88" class="headerlink" title="能改什么"></a>能改什么</h2><p>东方正作STG能改的，主要是这几个：</p><ul><li><p>贴图：比如立绘，背景，UI贴图之类的</p></li><li><p>对话：人物对话，也包括对话时bgm的切换，角色的出现消失之类的</p></li><li><p>弹幕：也就是boss，道中的弹幕。不光是弹幕，其实整个敌人的行为，都可以修改</p></li><li><p>机体：包括自机的火力数据，移动速度以及贴图等等。我之前做的那个“强拆地灵殿”其实本质上就是火力数据修改</p></li><li><p>音乐：不光包括bgm，也包括各种音效（比如擦弹音效，biu~之类的）</p></li></ul><p>大多数魔改都是指上面的内容。当然，有些技术力高的dalao（比如鶸，Priw8，yuke等）也会魔改一些其他的东西。比如把地灵殿的魔B移植到绀珠传里，让画面看起来像滚筒洗衣机一样，让移动对象从自机变成画面等等。不过这些一般难度都比较高，需要用到汇编等知识，门槛也相对比较高。其他的一些，比如换贴图，是最简单的一类魔改。</p><h2 id="怎么改"><a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/#%E6%80%8E%E4%B9%88%E6%94%B9" class="headerlink" title="怎么改"></a>怎么改</h2><p>说了这么多，到底怎么改呢？以东方地灵殿为例，我就介绍下魔改的大概流程。</p><h3 id="魔改对象"><a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/#%E9%AD%94%E6%94%B9%E5%AF%B9%E8%B1%A1" class="headerlink" title="魔改对象"></a>魔改对象</h3><p>首先，我们得了解下原作的文件目录结构。</p><p><img src="https://mxts.jiujiuer.xyz/img/mg-1-1.png"/></p><p>这是东方地灵殿的目录。主要文件只有这几个：</p><ul><li><p>custom/custom_c.exe：这是游戏的设置程序。各种高级设置（比如图像质量之类的）都在这里修改。不过并不是核心程序。也就是说，没了它，游戏还能运行。</p></li><li><p>th11/th11c.dat：我们魔改的核心对象。存储了所有贴图，对话，弹幕脚本，火力数据，音效文件，音乐循环点等关键信息。</p></li><li><p>th11/th11c.exe：游戏本体。600多K的大小。也是魔改的一个重要对象，不过因为门槛比较高，所以现阶段就不过多介绍了。</p></li><li><p>thbgm/thbgmogg.dat：游戏音乐。也就是酒鬼写的曲包。这个ogg是因为我为了精简游戏体积（便于传教XD），所以用工具压缩了音乐包的体积（毕竟原体积300+MB，实在太大了）。同时，有了专门修改过的d3d9.dll，这个压缩过的曲包才能被正确识别。也就是说，对于原版游戏，是没有d3d9.dll,曲包也是叫thbgm.dat的。</p></li></ul><h3 id="魔改工具"><a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/#%E9%AD%94%E6%94%B9%E5%B7%A5%E5%85%B7" class="headerlink" title="魔改工具"></a>魔改工具</h3><p>这篇文章，我只介绍怎么解包原作的文件（比如这作就是th11/th11c.dat）。所以用到的工具只有一个：Touhou Toolkit（thtk）。顾名思义，thtk是东方的工具包。详情可以上<a href="https://github.com/thpatch/thtk">GitHub看看</a>。</p><p>不过注意，这个工具是没有GUI（图形界面）的，只能在命令行里用指令进行操作。所以入门相对而言会麻烦一些。好在有julao写了图形化的re_thtk_gui，便于使用。详情请看<a href="https://github.com/RUEEE/re_thtk_gui/">这里</a>。</p><h2 id="开始"><a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/#%E5%BC%80%E5%A7%8B" class="headerlink" title="开始"></a>开始</h2><ul><li><p>打开工具，左上角菜单里选择正确的版本。在thdat选项组里找到第二行：文件路径。</p></li><li><p>点击右侧三个点，找到你的游戏目录，打开目录中th11/th11c.dat。</p></li></ul><p><img src="https://mxts.jiujiuer.xyz/file/img/mg-1-2.png"/></p><ul><li><p>点击解包、获取文件列表，等待执行完毕。</p></li><li><p>完成后，打开游戏目录。你会看到新增了data文件夹。打开data文件夹，你会看到游戏的大部分资源，包括音效、贴图、ECL弹幕脚本等。</p></li></ul><p>到这里还没有结束。因为只有音效是可以直接用的，其他的还是压缩状态。怎么办？很简单，用工具解包它们！</p><ul><li><p>以thanm（即贴图）为例。对于后缀为.anm的文件，我们在工具的thanm选项组里找到第二行</p></li><li><p>和thdat的解包方法一样，点击右侧三个点，进入刚生成的data文件夹中，选择要解包的anm文件</p></li><li><p>点击解包、获取描述文件，等待完成</p></li></ul><p>完成后，去data目录里看一看，是不是生成了一个ANM文件夹？它就是我们的解包成果。点开里面的目录，就是我们想要的贴图！</p><p>我们可以对贴图进行修改，然后先点击thanm的打包，再点击thdat的打包，生成打包好的th11/th11c.dat。打开游戏，就能看到你的成果了。</p><p>比如我一个改贴图的屑作：<a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/%E3%80%90%E9%AD%94%E6%94%B9%E3%80%91%E4%B8%9C%E6%96%B9%E8%99%B9%E9%BE%99%E4%BC%A0%EF%BC%88%EF%BC%9F.md">【魔改】东方虹龙传（？</a>，试图把六面变成纯狐（</p><h2 id="结尾"><a href="https://mxts.jiujiuer.xyz/2021/07/20/%E6%B8%B8%E6%88%8F/%E4%B8%9C%E6%96%B9Project/%E4%B8%9C%E6%96%B9STG%E9%AD%94%E6%94%B9%E6%97%A5%E5%BF%97-1-%E8%A7%A3%E5%8C%85/#%E7%BB%93%E5%B0%BE" class="headerlink" title="结尾"></a>结尾</h2><p>掌握了基本的解包打包技术后，你就能通过替换贴图来实现初等的魔改了。想想能做什么有意思的事吧（</p></body></html>