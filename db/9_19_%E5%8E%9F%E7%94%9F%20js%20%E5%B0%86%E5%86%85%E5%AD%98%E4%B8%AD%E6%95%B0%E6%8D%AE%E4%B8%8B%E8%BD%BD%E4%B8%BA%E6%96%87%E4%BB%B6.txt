<html><head></head><body><h1 id="原生-js-将内存中数据下载为文件">原生 js 将内存中数据下载为文件<a class="headerlink" href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#%E5%8E%9F%E7%94%9F-js-%E5%B0%86%E5%86%85%E5%AD%98%E4%B8%AD%E6%95%B0%E6%8D%AE%E4%B8%8B%E8%BD%BD%E4%B8%BA%E6%96%87%E4%BB%B6" title="Permanent link">¶</a></h1><!-- more --><h2 id="实现">实现<a class="headerlink" href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#%E5%AE%9E%E7%8E%B0" title="Permanent link">¶</a></h2><p>借助 <code>HTMLAnchorElement</code> 实现。</p><div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-1"> 1</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-2"> 2</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-3"> 3</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-4"> 4</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-5"> 5</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-6"> 6</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-7"> 7</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-8"> 8</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-9"> 9</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-10">10</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-0-11">11</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="kd">function</span><span class="w"> </span><span class="nx">downloadAsFile</span><span class="p">(</span><span class="nx">fileName</span><span class="p">,</span><span class="w"> </span><span class="nx">obj</span><span class="p">)</span><span class="w"> </span><span class="p">{</span></span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="w"> </span><span class="kd">const</span><span class="w"> </span><span class="nx">a</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">);</span></span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3"></a></span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">download</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">fileName</span><span class="p">;</span></span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">&#39;none&#39;</span><span class="p">;</span></span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6"></a><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">href</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">obj</span><span class="p">);</span></span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7"></a></span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8"></a><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span></span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9"></a><span class="w"> </span><span class="nx">a</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span></span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10"></a><span class="w"> </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">a</span><span class="p">);</span></span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11"></a><span class="p">}</span></span></code></pre></div></td></tr></tbody></table></div><h2 id="例子">例子<a class="headerlink" href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#%E4%BE%8B%E5%AD%90" title="Permanent link">¶</a></h2><p>例如，要将 <code>data</code> 保存为 json 文件。可以创建一个 <code>Blob</code> 再调用上面的函数实现。</p><div class="highlight"><table class="highlighttable"><tbody><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-1-1">1</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-1-2">2</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-1-3">3</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-1-4">4</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-1-5">5</a></span><span class="normal"><a href="https://note.stalomeow.com/blog/posts/download-data-in-memory-as-file/#__codelineno-1-6">6</a></span></pre></div></td><td class="code"><div><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="kd">const</span><span class="w"> </span><span class="nx">blob</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="ow">new</span><span class="w"> </span><span class="nx">Blob</span><span class="p">([</span><span class="nb">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">data</span><span class="p">)],</span><span class="w"> </span><span class="p">{</span></span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2"></a><span class="w"> </span><span class="nx">type</span><span class="o">:</span><span class="w"> </span><span class="s2">&#34;application/json&#34;</span><span class="p">,</span></span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3"></a><span class="p">});</span></span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4"></a></span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5"></a><span class="c1">// 上面指定了 blob 的 MIME type 是 json，所以文件扩展名可以不写</span></span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6"></a><span class="nx">downloadAsFile</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="w"> </span><span class="nx">blob</span><span class="p">);</span></span></code></pre></div></td></tr></tbody></table></div></body></html>