<html><head></head><body><p>现在是6月22日下午15:38, 学不完了</p><p>期末速成计网这种层次感分明的东西有种爬天梯的感觉.</p><h1 id="Chapter-23-24-UDP-TCP和SCTP-拥塞控制和服务质量"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#Chapter-23-24-UDP-TCP%E5%92%8CSCTP-%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6%E5%92%8C%E6%9C%8D%E5%8A%A1%E8%B4%A8%E9%87%8F" class="headerlink" title="Chapter 23/24 UDP,TCP和SCTP/拥塞控制和服务质量"></a>Chapter 23/24 UDP,TCP和SCTP/拥塞控制和服务质量</h1><p>传输层概述(自己编的):</p><p>传输层提供的是端到端的逻辑通信, 一台主机上的所有进程<strong>复用</strong>同一个IP层. 数据到了传输层, 就会被<strong>分用</strong>到不同的应用程序上.</p><p>传输层所有功能:</p><ol><li>应用进程的逻辑通信</li><li>差错检测</li><li>无连接或者面向连接的服务<ol><li>无连接</li><li>面向连接<ol><li>连接管理(三次握手)</li><li>流量控制/拥塞控制</li></ol></li></ol></li><li>复用/分用</li></ol><p>我们经常说传输层是可靠的, 但是传输层的UDP并不提供可靠性, 所以说传输层是可靠的是面对TCP来说的. 实际上每一层都有可靠和不可靠的协议, 单独直接说某一层可靠或者不可靠是笼统的. 例如在几十年前人们都说链路层就已经是可靠的了, 是因为那时候链路层普遍使用了HDLC协议. 现在由于网络质量改善, 链路层普遍使用了不可靠的PPP协议, 我们又说链路层是不可靠的了. 同样, 有无连接也是这样的, 现在我们说网络层无连接, TCP才提供了连接, 是因为IP协议是无连接的, 之前的X.25之类有连接的网络层协议被淘汰了而已.</p><p>马上就要考试了这么多没学我还在这写这些东西, 迟早要挂.</p><h2 id="熟知的端口号"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E7%86%9F%E7%9F%A5%E7%9A%84%E7%AB%AF%E5%8F%A3%E5%8F%B7" class="headerlink" title="熟知的端口号"></a>熟知的端口号</h2><p>常识</p><ol><li>FTP: 20(数据),21(控制)</li><li>Telnet: 23</li><li>SMTP: 25</li><li>DNS: 53</li><li>TFTP: 69</li><li>HTTP: 80</li><li>SNMP: 161</li></ol><h2 id="套接字"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E5%A5%97%E6%8E%A5%E5%AD%97" class="headerlink" title="套接字"></a>套接字</h2><p>套接字就是IP+端口号.</p><h2 id="UDP"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#UDP" class="headerlink" title="UDP"></a>UDP</h2><p>常识就不多说了.</p><h3 id="UDP校验"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#UDP%E6%A0%A1%E9%AA%8C" class="headerlink" title="UDP校验"></a>UDP校验</h3><p>UDP的头只记录了源端口, 目的端口, 和数据的长度(包括头部).</p><p>在检验的时候, 需要加一个12B的伪头部一起校验, 但是这终究还是个伪头部, 不会被发出去.</p><p>伪头部里包含了源IP和目的IP, 还有一些奇怪的东西.</p><p>校验就是把从首部到数据结束的所有东西两个字节两个字节加在一起, 如果数据不是偶数就要补一个0字节.</p><p>注意, 校验过程中遇到的校验位按照0算.</p><p>算出来一个2B的东西, 取反就是校验位.</p><p>验证的时候把校验位和所有东西加在一起, 如果结果是全1, 就说明数据没大问题.</p><h2 id="TCP"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#TCP" class="headerlink" title="TCP"></a>TCP</h2><h3 id="段格式"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E6%AE%B5%E6%A0%BC%E5%BC%8F" class="headerlink" title="段格式"></a>段格式</h3><p>我服了, 这nm全要背.</p><p><img src="https://honoka.tech/img/Chapter23-24.assets/image-20210622163103789.png.webp" class="lazyload" data-srcset="/img/Chapter23-24.assets/image-20210622163103789.png.webp" srcset="data:image/gif;base64,R0lGODlhAQABAIAAAP///////yH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="image-20210622163103789"/></p><ol><li>懒得解释了</li><li>懒得解释了</li><li>序号, 就是Seq, 现在要发的第一个字节的编号. 注意TCP是给字节编号, 所以如果这个TCP发了100B数据, Seq=701, 下一个TCP的Seq=801</li><li>确认号, 字节编号, 是累积确认, 是期望得到的下一个字节的编号.</li><li>数据偏移, 其实就是头部的长度, 跟IP首部长度一样, 单位是4B. 注意这个跟IP分段的那个数据偏移不一样.</li><li>保留字段,  现在没用.</li><li>紧急URG, 表示这个TCP包比较急, 从开始到紧急指针指向的地方这部分数据不进缓冲区直接发出去吧, 剩下的数据还是要进缓冲区的.</li><li>确认ACK, ACK=1的时候确认号才有用. 一旦TCP建立了, ACK必须都要为1.</li><li>推送PSH, 这个数据也急, 但是不完全急, 要进缓冲区, 但是进了缓冲区就赶紧交付给上层, 不要等缓冲区满了再交付.</li><li>复位RST, RST=1的时候, 表示出了大问题, 要把TCP断掉重连.</li><li>同步SYN, 建立连接用的.</li><li>终止FIN, 终止连接标志.</li><li>窗口字段, 表示接收方现在还有多少接收缓存.</li><li>校验和, 和UDP一样, 计算的时候要加假头(假头的内容和UDP有一个东西不一样, 要把17改成6)</li><li>紧急指针, 就是开始到这里的数据都是紧急数据, 在URG里面提到过.</li><li>选项字段, 长度可变.</li><li>填充字段, 要把整个首部填成4B的整数倍.</li></ol><h3 id="TCP连接建立"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#TCP%E8%BF%9E%E6%8E%A5%E5%BB%BA%E7%AB%8B" class="headerlink" title="TCP连接建立"></a>TCP连接建立</h3><p>经典三次握手.</p><ol><li>发送方发, SYN = 1, Seq = x. 这时不能带数据.</li><li>服务器发, SYN = 1, Seq = y, ACK = x+1. 这时也不能带数据.</li><li>发送方发, SYN = 0, Seq = x+1, ACK = y+1. 可以带数据发了.</li></ol><p><strong>只有最后一个段能带数据发, 但是所有的段都占用了编号</strong></p><h3 id="TCP连接拆除"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#TCP%E8%BF%9E%E6%8E%A5%E6%8B%86%E9%99%A4" class="headerlink" title="TCP连接拆除"></a>TCP连接拆除</h3><p>经典四次挥手.</p><ol><li>要关闭连接的一方A发, FIN = 1, Seq = u.</li><li>B发, ACK = u+1, Seq = v. 这时候B有可能还有数据要发, B会接着发, A这时候也要接着收, 但是A不会再发东西了.</li><li>B数据发完了, 发FIN=1, Seq = w, ACK = u+1. B到了LAST-ACK.</li><li>A发, ACK = w+1, Seq = u+1.</li></ol><p><strong>FIN只有第一次和第三次为1</strong></p><h3 id="TCP可靠传输机制"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#TCP%E5%8F%AF%E9%9D%A0%E4%BC%A0%E8%BE%93%E6%9C%BA%E5%88%B6" class="headerlink" title="TCP可靠传输机制"></a>TCP可靠传输机制</h3><h4 id="序号"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E5%BA%8F%E5%8F%B7" class="headerlink" title="序号"></a>序号</h4><p>TCP每次建立连接的时候, 都要选择一个不同的初始序号.</p><h4 id="重传"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E9%87%8D%E4%BC%A0" class="headerlink" title="重传"></a>重传</h4><p>首先, 发送方会动态估计RTT.</p><p><svg style="vertical-align: -0.566ex;" xmlns="http://www.w3.org/2000/svg" width="39.1ex" height="2.262ex" role="img" focusable="false" viewBox="0 -750 17282.3 1000" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-1-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-1-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-1-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-1-TEX-N-28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path><path id="MJX-1-TEX-N-31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path id="MJX-1-TEX-N-2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path><path id="MJX-1-TEX-I-1D6FC" d="M34 156Q34 270 120 356T309 442Q379 442 421 402T478 304Q484 275 485 237V208Q534 282 560 374Q564 388 566 390T582 393Q603 393 603 385Q603 376 594 346T558 261T497 161L486 147L487 123Q489 67 495 47T514 26Q528 28 540 37T557 60Q559 67 562 68T577 70Q597 70 597 62Q597 56 591 43Q579 19 556 5T512 -10H505Q438 -10 414 62L411 69L400 61Q390 53 370 41T325 18T267 -2T203 -11Q124 -11 79 39T34 156ZM208 26Q257 26 306 47T379 90L403 112Q401 255 396 290Q382 405 304 405Q235 405 183 332Q156 292 139 224T121 120Q121 71 146 49T208 26Z"></path><path id="MJX-1-TEX-N-29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path><path id="MJX-1-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path><path id="MJX-1-TEX-N-2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-1-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(759,0)"><use data-c="1D447" xlink:href="#MJX-1-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(1463,0)"><use data-c="1D447" xlink:href="#MJX-1-TEX-I-1D447"></use></g><g data-mml-node="mo" transform="translate(2444.8,0)"><use data-c="3D" xlink:href="#MJX-1-TEX-N-3D"></use></g><g data-mml-node="mo" transform="translate(3500.6,0)"><use data-c="28" xlink:href="#MJX-1-TEX-N-28"></use></g><g data-mml-node="mn" transform="translate(3889.6,0)"><use data-c="31" xlink:href="#MJX-1-TEX-N-31"></use></g><g data-mml-node="mo" transform="translate(4611.8,0)"><use data-c="2212" xlink:href="#MJX-1-TEX-N-2212"></use></g><g data-mml-node="mi" transform="translate(5612,0)"><use data-c="1D6FC" xlink:href="#MJX-1-TEX-I-1D6FC"></use></g><g data-mml-node="mo" transform="translate(6252,0)"><use data-c="29" xlink:href="#MJX-1-TEX-N-29"></use></g><g data-mml-node="mo" transform="translate(6863.2,0)"><use data-c="D7" xlink:href="#MJX-1-TEX-N-D7"></use></g><g data-mml-node="mi" transform="translate(7863.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">旧</text></g><g data-mml-node="mi" transform="translate(8863.4,0)"><use data-c="1D445" xlink:href="#MJX-1-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(9622.4,0)"><use data-c="1D447" xlink:href="#MJX-1-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(10326.4,0)"><use data-c="1D447" xlink:href="#MJX-1-TEX-I-1D447"></use></g><g data-mml-node="mo" transform="translate(11252.7,0)"><use data-c="2B" xlink:href="#MJX-1-TEX-N-2B"></use></g><g data-mml-node="mi" transform="translate(12252.9,0)"><use data-c="1D6FC" xlink:href="#MJX-1-TEX-I-1D6FC"></use></g><g data-mml-node="mo" transform="translate(13115.1,0)"><use data-c="D7" xlink:href="#MJX-1-TEX-N-D7"></use></g><g data-mml-node="mi" transform="translate(14115.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">新</text></g><g data-mml-node="mi" transform="translate(15115.3,0)"><use data-c="1D445" xlink:href="#MJX-1-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(15874.3,0)"><use data-c="1D447" xlink:href="#MJX-1-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(16578.3,0)"><use data-c="1D447" xlink:href="#MJX-1-TEX-I-1D447"></use></g></g></g></svg></p><p>然后, 超时重传时间<svg style="vertical-align: -0.439ex;" xmlns="http://www.w3.org/2000/svg" width="17.002ex" height="2.034ex" role="img" focusable="false" viewBox="0 -705 7515 899" xmlns:xlink="http://www.w3.org/1999/xlink"><defs><path id="MJX-2-TEX-I-1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"></path><path id="MJX-2-TEX-I-1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path><path id="MJX-2-TEX-I-1D442" d="M740 435Q740 320 676 213T511 42T304 -22Q207 -22 138 35T51 201Q50 209 50 244Q50 346 98 438T227 601Q351 704 476 704Q514 704 524 703Q621 689 680 617T740 435ZM637 476Q637 565 591 615T476 665Q396 665 322 605Q242 542 200 428T157 216Q157 126 200 73T314 19Q404 19 485 98T608 313Q637 408 637 476Z"></path><path id="MJX-2-TEX-N-3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path><path id="MJX-2-TEX-I-1D6FD" d="M29 -194Q23 -188 23 -186Q23 -183 102 134T186 465Q208 533 243 584T309 658Q365 705 429 705H431Q493 705 533 667T573 570Q573 465 469 396L482 383Q533 332 533 252Q533 139 448 65T257 -10Q227 -10 203 -2T165 17T143 40T131 59T126 65L62 -188Q60 -194 42 -194H29ZM353 431Q392 431 427 419L432 422Q436 426 439 429T449 439T461 453T472 471T484 495T493 524T501 560Q503 569 503 593Q503 611 502 616Q487 667 426 667Q384 667 347 643T286 582T247 514T224 455Q219 439 186 308T152 168Q151 163 151 147Q151 99 173 68Q204 26 260 26Q302 26 349 51T425 137Q441 171 449 214T457 279Q457 337 422 372Q380 358 347 358H337Q258 358 258 389Q258 396 261 403Q275 431 353 431Z"></path><path id="MJX-2-TEX-N-D7" d="M630 29Q630 9 609 9Q604 9 587 25T493 118L389 222L284 117Q178 13 175 11Q171 9 168 9Q160 9 154 15T147 29Q147 36 161 51T255 146L359 250L255 354Q174 435 161 449T147 471Q147 480 153 485T168 490Q173 490 175 489Q178 487 284 383L389 278L493 382Q570 459 587 475T609 491Q630 491 630 471Q630 464 620 453T522 355L418 250L522 145Q606 61 618 48T630 29Z"></path></defs><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><use data-c="1D445" xlink:href="#MJX-2-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(759,0)"><use data-c="1D447" xlink:href="#MJX-2-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(1463,0)"><use data-c="1D442" xlink:href="#MJX-2-TEX-I-1D442"></use></g><g data-mml-node="mo" transform="translate(2503.8,0)"><use data-c="3D" xlink:href="#MJX-2-TEX-N-3D"></use></g><g data-mml-node="mi" transform="translate(3559.6,0)"><use data-c="1D6FD" xlink:href="#MJX-2-TEX-I-1D6FD"></use></g><g data-mml-node="mo" transform="translate(4347.8,0)"><use data-c="D7" xlink:href="#MJX-2-TEX-N-D7"></use></g><g data-mml-node="mi" transform="translate(5348,0)"><use data-c="1D445" xlink:href="#MJX-2-TEX-I-1D445"></use></g><g data-mml-node="mi" transform="translate(6107,0)"><use data-c="1D447" xlink:href="#MJX-2-TEX-I-1D447"></use></g><g data-mml-node="mi" transform="translate(6811,0)"><use data-c="1D447" xlink:href="#MJX-2-TEX-I-1D447"></use></g></g></g></svg></p><p>这个方法只有在TCP有用, UDP没有重传, 所以不需要.</p><p>即使链路层是完美的, 这些可靠传输机制也是必要的. 数据报可能会因经过的路由不同而失序, 或者路由错误计算导致TTL减到0, 或者中间某个路由器缓存炸了.</p><h3 id="TCP流量控制"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#TCP%E6%B5%81%E9%87%8F%E6%8E%A7%E5%88%B6" class="headerlink" title="TCP流量控制"></a>TCP流量控制</h3><h4 id="滑动窗口"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E6%BB%91%E5%8A%A8%E7%AA%97%E5%8F%A3" class="headerlink" title="滑动窗口"></a>滑动窗口</h4><p>发送方和接收方都维护了一个滑动窗口, 长度在连接过程中会协商.</p><p>这个窗口和之前ARQ的窗口差不多, 注意就是发送方和接收方的窗口大小都是不固定的. 而且TCP的序号没有限制, 所以不会出现特别奇怪的问题.</p><h4 id="超时"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E8%B6%85%E6%97%B6" class="headerlink" title="超时"></a>超时</h4><p>TCP为每个发送的报文段设置单独的计时器, 计时器超过RTO的时还没收到ACK就会重发.</p><h4 id="快速重传"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0" class="headerlink" title="快速重传"></a>快速重传</h4><p>如果发送方连续接收到三次同一个ACK, 就知道那个数据肯定出事了, 就会直接重传那一个. 不用等到超时.</p><h4 id="零窗口"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E9%9B%B6%E7%AA%97%E5%8F%A3" class="headerlink" title="零窗口"></a>零窗口</h4><p>接收方返回的ACK里面包含了接收方的缓存还有多大, 如果接收方不想收了, 或者收不了了, 可以返回一个带有rwnd=0的ACK, 这样发送方就会暂停发送. 等到接收方想收了, 它可以再发一个东西通知他继续发. 并且发送方还会每隔一段时间发一个试探性的包来询问接收窗口.</p><h2 id="TCP拥塞控制"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#TCP%E6%8B%A5%E5%A1%9E%E6%8E%A7%E5%88%B6" class="headerlink" title="TCP拥塞控制"></a>TCP拥塞控制</h2><p>流量控制只是两端的问题, 格局小了.</p><p>拥塞控制是为了整个网络着想, 格局很大.</p><h3 id="rwnd和cwnd"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#rwnd%E5%92%8Ccwnd" class="headerlink" title="rwnd和cwnd"></a>rwnd和cwnd</h3><p>rwnd是接收端窗口, 与接收端缓存大小有关.</p><p>cwnd是拥塞窗口, 与发送方对网络情况的估计有关.</p><p>发送端真正的窗口大小应该是两个窗口的最小值.</p><h3 id="慢启动算法"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E6%85%A2%E5%90%AF%E5%8A%A8%E7%AE%97%E6%B3%95" class="headerlink" title="慢启动算法"></a>慢启动算法</h3><p>在刚开始, 发送方将cwnd设为1, 就是一个MSS的大小.</p><p>然后每次收到一个ACK之后, cwnd都会+1.</p><p>这样看起来增长的很慢, 实际上cwnd+1之后, 每次发送的数据也会变多, 收到的ACK也会变多, 所以cwnd实际上是指数级增长的.</p><h3 id="拥塞避免算法"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E6%8B%A5%E5%A1%9E%E9%81%BF%E5%85%8D%E7%AE%97%E6%B3%95" class="headerlink" title="拥塞避免算法"></a>拥塞避免算法</h3><p>为了阻止cwnd指数增长, 在TCP开始之前, 需要一个慢启动门限ssthresh.</p><p>在cwnd小于等于ssthresh时, 使用慢启动算法; (指数增长)</p><p>cwnd大于ssthresh时, cwnd每过一个RTT就会+1. (线性增长)</p><p>无论在什么时候, 只要出现网络堵塞的情况(就是ACK超时没发过来), ssthresh就会变成拥塞窗口的一半(但是不能小于2)(乘法减小), cwnd从1开始重新来.</p><h3 id="快速重传算法"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E5%BF%AB%E9%80%9F%E9%87%8D%E4%BC%A0%E7%AE%97%E6%B3%95" class="headerlink" title="快速重传算法"></a>快速重传算法</h3><p>上面讲过了.</p><h3 id="快速恢复算法"><a href="https://honoka.tech/2021/07/10/Chapter23-24/#%E5%BF%AB%E9%80%9F%E6%81%A2%E5%A4%8D%E7%AE%97%E6%B3%95" class="headerlink" title="快速恢复算法"></a>快速恢复算法</h3><p>发送端连续收到三个连续相同确认后, 就执行乘法减小, 把门限减少为原来的一半. 但是新的cwnd不是改成1, 而是改成新的门限.</p></body></html>